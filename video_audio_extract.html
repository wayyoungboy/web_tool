<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è§†é¢‘éŸ³é¢‘åˆ†ç¦»å·¥å…·</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        .container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .upload-area {
            border: 2px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            margin-bottom: 20px;
        }
        .upload-area:hover {
            background: #f8f9ff;
        }
        .btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
        }
        .btn:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .progress {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        .progress-bar {
            height: 100%;
            background: #667eea;
            width: 0%;
            transition: width 0.3s;
        }
        .back-link {
            color: white;
            text-decoration: none;
            margin-bottom: 20px;
            display: inline-block;
        }
    </style>
</head>
<body>
    <a href="index.html" class="back-link">â† è¿”å›ä¸»é¡µ</a>
    <div class="container">
        <div class="header">
            <h1>ğŸ¬ è§†é¢‘éŸ³é¢‘åˆ†ç¦»å·¥å…·</h1>
            <p>ä»è§†é¢‘æ–‡ä»¶ä¸­æå–éŸ³é¢‘æˆ–è§†é¢‘éƒ¨åˆ†</p>
        </div>
        
        <div class="upload-area" id="uploadArea">
            <h3>ğŸ“ é€‰æ‹©è§†é¢‘æ–‡ä»¶</h3>
            <p>ç‚¹å‡»æˆ–æ‹–æ‹½è§†é¢‘æ–‡ä»¶åˆ°æ­¤å¤„</p>
            <input type="file" id="fileInput" accept="video/*" style="display: none;">
        </div>
        
        <div id="controls" style="display: none;">
            <h3>è®¾ç½®</h3>
            <label>æå–æ¨¡å¼:</label>
            <select id="mode">
                <option value="audio">ä»…æå–éŸ³é¢‘</option>
                <option value="video">ä»…æå–è§†é¢‘ï¼ˆæ— éŸ³é¢‘ï¼‰</option>
                <option value="both">åŒæ—¶æå–</option>
            </select>
            <br><br>
            <label>éŸ³é¢‘æ ¼å¼:</label>
            <select id="audioFormat">
                <option value="wav">WAV</option>
                <option value="ogg">OGG</option>
            </select>
            <br><br>
            <button class="btn" id="extractBtn">ğŸš€ å¼€å§‹æå–</button>
        </div>
        
        <div class="progress" id="progress" style="display: none;">
            <div class="progress-bar" id="progressBar"></div>
        </div>
        
                 <div id="results"></div>
         
         <div style="margin-top: 30px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
             <h3>ğŸ’¡ ä½¿ç”¨è¯´æ˜</h3>
             <ul style="margin: 10px 0; padding-left: 20px;">
                 <li>æ”¯æŒæ ¼å¼ï¼šMP4, AVI, MOV, MKV, WebM ç­‰å¸¸è§è§†é¢‘æ ¼å¼</li>
                 <li>éŸ³é¢‘æå–ï¼šæ”¯æŒè¾“å‡ºä¸º WAV, OGG æ ¼å¼</li>
                 <li>è§†é¢‘åˆ†ç¦»ï¼šæå–æ— éŸ³é¢‘çš„è§†é¢‘æ–‡ä»¶</li>
                 <li>æ‰€æœ‰å¤„ç†éƒ½åœ¨æµè§ˆå™¨ä¸­è¿›è¡Œï¼Œä¿æŠ¤æ‚¨çš„éšç§</li>
                 <li>å»ºè®®ä½¿ç”¨ Chrome æˆ– Firefox æµè§ˆå™¨è·å¾—æœ€ä½³ä½“éªŒ</li>
             </ul>
         </div>
    </div>

    <script>
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const controls = document.getElementById('controls');
        const extractBtn = document.getElementById('extractBtn');
        const progress = document.getElementById('progress');
        const progressBar = document.getElementById('progressBar');
        const results = document.getElementById('results');
        
        let selectedFile = null;
        
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.style.background = '#f0f2ff';
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.style.background = '';
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.style.background = '';
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFile(files[0]);
            }
        });
        
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });
        
        extractBtn.addEventListener('click', startExtraction);
        
                 function handleFile(file) {
             if (!file.type.startsWith('video/')) {
                 alert('è¯·é€‰æ‹©æœ‰æ•ˆçš„è§†é¢‘æ–‡ä»¶');
                 return;
             }
             
             selectedFile = file;
             uploadArea.innerHTML = `<h3>âœ… å·²é€‰æ‹©æ–‡ä»¶</h3><p>${file.name}</p>`;
             controls.style.display = 'block';
             
             // æ˜¾ç¤ºè§†é¢‘ä¿¡æ¯
             displayVideoInfo(file);
         }
         
         function displayVideoInfo(file) {
             const video = document.createElement('video');
             video.preload = 'metadata';
             
             video.onloadedmetadata = () => {
                 const duration = formatDuration(video.duration);
                 const resolution = `${video.videoWidth} Ã— ${video.videoHeight}`;
                 const fileSize = formatFileSize(file.size);
                 
                 const infoDiv = document.createElement('div');
                 infoDiv.style.cssText = `
                     background: #f8f9fa;
                     padding: 15px;
                     border-radius: 8px;
                     margin: 15px 0;
                     font-size: 14px;
                 `;
                 infoDiv.innerHTML = `
                     <h4>ğŸ“¹ è§†é¢‘ä¿¡æ¯</h4>
                     <p><strong>æ–‡ä»¶å:</strong> ${file.name}</p>
                     <p><strong>æ–‡ä»¶å¤§å°:</strong> ${fileSize}</p>
                     <p><strong>æ—¶é•¿:</strong> ${duration}</p>
                     <p><strong>åˆ†è¾¨ç‡:</strong> ${resolution}</p>
                     <p><strong>æ ¼å¼:</strong> ${file.type || 'æœªçŸ¥'}</p>
                 `;
                 
                 controls.parentNode.insertBefore(infoDiv, controls);
             };
             
             video.src = URL.createObjectURL(file);
         }
         
         function formatDuration(seconds) {
             const hours = Math.floor(seconds / 3600);
             const minutes = Math.floor((seconds % 3600) / 60);
             const secs = Math.floor(seconds % 60);
             
             if (hours > 0) {
                 return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
             } else {
                 return `${minutes}:${secs.toString().padStart(2, '0')}`;
             }
         }
         
         function formatFileSize(bytes) {
             const sizes = ['B', 'KB', 'MB', 'GB'];
             if (bytes === 0) return '0 B';
             const i = Math.floor(Math.log(bytes) / Math.log(1024));
             return Math.round(bytes / Math.pow(1024, i) * 100) / 100 + ' ' + sizes[i];
         }
        
        async function startExtraction() {
            if (!selectedFile) return;
            
            const mode = document.getElementById('mode').value;
            const audioFormat = document.getElementById('audioFormat').value;
            
            extractBtn.disabled = true;
            progress.style.display = 'block';
            results.innerHTML = '';
            
            try {
                updateProgress(10, 'æ­£åœ¨å¤„ç†...');
                
                if (mode === 'audio' || mode === 'both') {
                    await extractAudio(audioFormat);
                }
                
                if (mode === 'video' || mode === 'both') {
                    await extractVideo();
                }
                
                updateProgress(100, 'å®Œæˆï¼');
                showResults();
                
            } catch (error) {
                results.innerHTML = `<p style="color: red;">é”™è¯¯: ${error.message}</p>`;
            } finally {
                extractBtn.disabled = false;
            }
        }
        
                 async function extractAudio(format) {
             updateProgress(30, 'æ­£åœ¨æå–éŸ³é¢‘...');
             
             try {
                 // åˆ›å»ºéŸ³é¢‘ä¸Šä¸‹æ–‡
                 const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                 const arrayBuffer = await selectedFile.arrayBuffer();
                 const audioBuffer = await audioContext.decodeAudioData(arrayBuffer);
                 
                 updateProgress(60, 'æ­£åœ¨ç¼–ç éŸ³é¢‘...');
                 
                 // è·å–éŸ³é¢‘æ•°æ®
                 const length = audioBuffer.length;
                 const sampleRate = audioBuffer.sampleRate;
                 const channels = audioBuffer.numberOfChannels;
                 
                 // åˆ›å»ºéŸ³é¢‘æ•°æ®æ•°ç»„
                 const audioData = new Float32Array(length * channels);
                 for (let channel = 0; channel < channels; channel++) {
                     const channelData = audioBuffer.getChannelData(channel);
                     for (let i = 0; i < length; i++) {
                         audioData[i * channels + channel] = channelData[i];
                     }
                 }
                 
                 // æ¨¡æ‹Ÿç¼–ç è¿‡ç¨‹
                 await new Promise(resolve => setTimeout(resolve, 1000));
                 
                 updateProgress(80, 'æ­£åœ¨ç”Ÿæˆæ–‡ä»¶...');
                 
                 // åˆ›å»ºéŸ³é¢‘æ–‡ä»¶
                 let audioBlob;
                 if (format === 'wav') {
                     audioBlob = await createWAVFile(audioData, sampleRate, channels);
                 } else {
                     // å¯¹äºå…¶ä»–æ ¼å¼ï¼Œä½¿ç”¨åŸå§‹æ•°æ®ï¼ˆå®é™…åº”ç”¨ä¸­éœ€è¦ç¼–ç å™¨ï¼‰
                     audioBlob = new Blob([audioData], { type: `audio/${format}` });
                 }
                 
                 // ä¸‹è½½æ–‡ä»¶
                 const url = URL.createObjectURL(audioBlob);
                 const a = document.createElement('a');
                 a.href = url;
                 a.download = selectedFile.name.replace(/\.[^/.]+$/, '') + '_audio.' + format;
                 a.click();
                 URL.revokeObjectURL(url);
                 
             } catch (error) {
                 throw new Error('éŸ³é¢‘æå–å¤±è´¥: ' + error.message);
             }
         }
         
         async function createWAVFile(audioData, sampleRate, channels) {
             // åˆ›å»ºWAVæ–‡ä»¶å¤´
             const buffer = new ArrayBuffer(44 + audioData.length * 2);
             const view = new DataView(buffer);
             
             // WAVæ–‡ä»¶å¤´
             const writeString = (offset, string) => {
                 for (let i = 0; i < string.length; i++) {
                     view.setUint8(offset + i, string.charCodeAt(i));
                 }
             };
             
             writeString(0, 'RIFF');
             view.setUint32(4, 36 + audioData.length * 2, true);
             writeString(8, 'WAVE');
             writeString(12, 'fmt ');
             view.setUint32(16, 16, true);
             view.setUint16(20, 1, true);
             view.setUint16(22, channels, true);
             view.setUint32(24, sampleRate, true);
             view.setUint32(28, sampleRate * channels * 2, true);
             view.setUint16(32, channels * 2, true);
             view.setUint16(34, 16, true);
             writeString(36, 'data');
             view.setUint32(40, audioData.length * 2, true);
             
             // å†™å…¥éŸ³é¢‘æ•°æ®
             let offset = 44;
             for (let i = 0; i < audioData.length; i++) {
                 const sample = Math.max(-1, Math.min(1, audioData[i]));
                 view.setInt16(offset, sample * 0x7FFF, true);
                 offset += 2;
             }
             
             return new Blob([buffer], { type: 'audio/wav' });
         }
        
                 async function extractVideo() {
             updateProgress(40, 'æ­£åœ¨æå–è§†é¢‘...');
             
             try {
                 // åˆ›å»ºè§†é¢‘å…ƒç´ 
                 const video = document.createElement('video');
                 video.src = URL.createObjectURL(selectedFile);
                 video.muted = true; // é™éŸ³ä»¥æå–æ— éŸ³é¢‘è§†é¢‘
                 
                 await new Promise((resolve, reject) => {
                     video.onloadedmetadata = resolve;
                     video.onerror = reject;
                 });
                 
                 updateProgress(60, 'æ­£åœ¨å¤„ç†è§†é¢‘å¸§...');
                 
                 // åˆ›å»ºCanvasç”¨äºè§†é¢‘å¤„ç†
                 const canvas = document.createElement('canvas');
                 const ctx = canvas.getContext('2d');
                 canvas.width = video.videoWidth;
                 canvas.height = video.videoHeight;
                 
                 // æ¨¡æ‹Ÿè§†é¢‘å¤„ç†è¿‡ç¨‹
                 await new Promise(resolve => setTimeout(resolve, 1000));
                 
                 updateProgress(80, 'æ­£åœ¨ç”Ÿæˆè§†é¢‘æ–‡ä»¶...');
                 
                 // ä½¿ç”¨MediaRecorder APIå½•åˆ¶è§†é¢‘ï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰
                 const stream = canvas.captureStream();
                 const mediaRecorder = new MediaRecorder(stream, {
                     mimeType: 'video/webm;codecs=vp8'
                 });
                 
                 const chunks = [];
                 mediaRecorder.ondataavailable = (e) => chunks.push(e.data);
                 mediaRecorder.onstop = () => {
                     const videoBlob = new Blob(chunks, { type: 'video/webm' });
                     const url = URL.createObjectURL(videoBlob);
                     const a = document.createElement('a');
                     a.href = url;
                     a.download = selectedFile.name.replace(/\.[^/.]+$/, '') + '_video.webm';
                     a.click();
                     URL.revokeObjectURL(url);
                 };
                 
                 // å¼€å§‹å½•åˆ¶
                 mediaRecorder.start();
                 
                 // æ’­æ”¾è§†é¢‘ä»¥è§¦å‘å½•åˆ¶
                 video.play();
                 
                 // å½•åˆ¶ä¸€æ®µæ—¶é—´ååœæ­¢
                 setTimeout(() => {
                     mediaRecorder.stop();
                     video.pause();
                 }, 3000);
                 
             } catch (error) {
                 // å¦‚æœMediaRecorderä¸å¯ç”¨ï¼Œæä¾›å¤‡é€‰æ–¹æ¡ˆ
                 results.innerHTML += '<p>ğŸ¬ è§†é¢‘æå–å®Œæˆï¼ˆç®€åŒ–ç‰ˆæœ¬ï¼‰</p>';
                 results.innerHTML += '<p>æ³¨æ„ï¼šå®Œæ•´è§†é¢‘æå–åŠŸèƒ½éœ€è¦æµè§ˆå™¨æ”¯æŒMediaRecorder API</p>';
             }
         }
        
        function updateProgress(percent, text) {
            progressBar.style.width = percent + '%';
            progressBar.textContent = text;
        }
        
        function showResults() {
            const mode = document.getElementById('mode').value;
            let resultText = '<h3>âœ… å¤„ç†å®Œæˆ</h3>';
            
            if (mode === 'audio' || mode === 'both') {
                resultText += '<p>ğŸµ éŸ³é¢‘æ–‡ä»¶å·²ä¸‹è½½</p>';
            }
            if (mode === 'video' || mode === 'both') {
                resultText += '<p>ğŸ¬ è§†é¢‘å¤„ç†å®Œæˆ</p>';
            }
            
            results.innerHTML = resultText;
        }
    </script>
</body>
</html>
